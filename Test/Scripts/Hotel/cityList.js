define(["cUtilDate","BizCityList","Toolkit","HotelModel","HotelStore","hUILoadingLayer","hUITab","UIMask","HotelBaseView","QueryFilter","BizQueryFilter","BizJetLag","cGeoService","SideNav"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){function j(e,t){if(t<0||typeof t=="undefined")return e;if(_.isArray(t)){var n=0;t=this.sort(t,!1);for(index in t)n=index-1,e=this.removeAt(e,t[index]);return e}return e.slice(0,t).concat(e.slice(t+1,e.length))}function F(e){var t=document.getElementsByTagName("html")[0],n=document.body;e?(t.style.overflow="",n.style.overflow=""):(t.style.overflow="hidden",n.style.overflow="hidden")}function I(e){var t=null,n=f.Q.getQueryParams().city,r=f.Q.getKey("isSearchListWithCity");return!!n&&!!n[e]&&(t=n[e]),r==0&&(t=null),t}function q(e){var t=!1,n=f.Q.getQueryParams().city;if(!n||n&&!n.cityId)return!1;if(!e||e&&!e.cityId)return!1;var r=e.did<=0&&n.did<=0||e.did===n.did?!0:!1;return e.cityId===n.cityId&&r&&(t=!0),t}function R(){f.Q.clearKey("price"),f.Q.clearKey("star"),f.Q.setKey({keyName:"days",data:1}),f.Q.setKey({keyName:"rooms",data:1})}function U(e){var t=e.trim();return t.indexOf("市")>0&&(t=t.replace("市","").trim()),t}function z(e){f.Q.setKey({keyName:"isSearchListWithCity",data:!!e})}function W(e,t,n){var r=new RegExp(t.replace(/([\(\)\[\]\{\}\^\$\+\-\*\?\.\"\'\|\/\\])/g,"\\$1"),"ig");return e.replace(r,n)}function V(e){try{var t={destination:"",destination_input:"",destination_type:"",property:"",ismatch:"",status:"",isoversea:""};_.extend(t,e);var n="h5_hotel_inquire_destination";window.__bfi.push(["_tracklog",n,JSON.stringify(t)])}catch(r){}}var d=e,v=h.GeoLocation,m=300,g={1:{name:"机场车站",map2KeyName:"airport"},2:{name:"商业区",map2KeyName:"zone"},4:{name:"行政区",map2KeyName:"district"},8:{name:"景区",map2KeyName:"city"},16:{name:"地标",map2KeyName:"landMark"},32:{name:"城市",map2KeyName:"city"},64:{name:"酒店",map2KeyName:"hotel"}},y="tzone",b=r.cityListSearchOverseaModel.getInstance(),w=r.DestinationGetModel.getInstance(),E=i.HotelQueryStore.getInstance(),S=i.protoCityListStore.getInstance(),x=i.renderCategoryCitiesStore.getInstance(),T=i.renderHisHotCityListStore.getInstance(),N=i.wordsCityListStore.getInstance(),C=i.PositionlStore.getInstance(),k=i.HotelDestinationACHistoryStore.getInstance(),L=i.HotelQueryKeywordDestinationACTempData.getInstance(),A={id:1,name:"国内城市",type:"inland"},O={1:{name:"国内城市",type:"inland"},2:{name:"海外城市",type:"oversea"}},M={historyCities:[],hotCities:[],categoryCities:{A:[],B:[],C:[],D:[],E:[],F:[],G:[],H:[],I:[],J:[],K:[],L:[],M:[],N:[],O:[],P:[],Q:[],R:[],S:[],T:[],U:[],V:[],W:[],X:[],Y:[],Z:[]},cityList:null,wordList:{}},D={inland:null,oversea:null},P={inland:null,oversea:null},H=null,B=[],X=a.extend({pageid:"210086",DesACList:null,searchTimeout:0,setPageId:function(){var e=this.isOutlandHotel()?"229002":"210086";this.pageid=e},_setStoreQueryHotelList:function(e){typeof e!="object"||!e?(f.Q.clearKey("city"),f.Q.setKey({keyName:"needGetGeo",data:!0}),C.set(null)):(f.Q.setKey({keyName:"city",data:e}),f.Q.setKey({keyName:"needGetGeo",data:!1}))},setPosition:function(){var e=this,t=f.Q.getKey("positionCity"),n=this.elmCurrentCity,r="",i=e.getDefaultCityName();_.isEmpty(t)?n&&e.loadingPosition(n):(r=t.cname,_.isEmpty(r)?n.hide():(r.indexOf("市")>0&&(r=r.replace("市","").trim()),i==r&&n.addClass("current"),n.html(r),n.attr("data-cityname",r),n.show()))},setHistoryCities:function(e,t){if(!e||!t)return;var n=e.toString()+".historyCities",r=t,i=this.getCacheCityList(e),s=null,o=null;if(!i)return;s=i.historyCities,!r||(_.each(s,function(e,t){var n=e.did<0?0:e.did,i=r.did<0?0:r.did;r.cityId===e.cityId&&i===n&&(o=t)}),o!=null?s=j(s,o):s.length>2&&s.pop(),s.unshift(r),T.setAttr(n,s))},setSelectedCityTab:function(e){return typeof e=="number"?e|=0:e=1,document.body.scrollTop=0,A=O[e]},getSelectedCityTab:function(){return A?A:A=O[1]},_goBack:function(e){this.back();if(!$(e.currentTarget).hasClass("js_search_back"))return;var t=L.getAttr("lastDestinationACInfo")||{},n=this.elmPopInput.val(),r="F";n==t.tempInputText&&t.tempACList&&t.tempACList.length&&(r="T"),V({destination_type:"input",destination_input:n,status:"cancel",ismatch:r,destination:"",property:"",isoversea:""})},getDefaultCityName:function(){var e=Lizard.P("cname");_.isEmpty(e)?e=I("cname"):e=U(e);if(!e||e==="我附近的酒店")e="我的位置";return e},getCacheCityList:function(e){return D[e]},isOutlandHotel:function(){var e=location.href.match(/hotel\/oversea\/citylist/i)?!0:!1;return e},validateStoreDate:function(){var t=f.Q.getKey("city"),n=t.tzone||0,r=c.isValidJetLag(n)?n:0,i=new Date(e.getServerDate().getTime()+r*1e3);i.setHours(0,0,0,0);var s=(new e(i)).format("Y-m-d"),o=f.Q.getKey("inDay")||(new e(i)).format("Y-m-d"),u=e.parse(o,!0);u.setHours(0,0,0,0);var a=e.getIntervalDay(s,o),l=f.Q.getKey("days")||1;a<=-1&&(o=s,l=1);var h=e.parse(o).addDay(l).format("Y-m-d");f.Q.setKey({keyName:"inDay",data:o}),f.Q.setKey({keyName:"outDay",data:h}),f.Q.setKey({keyName:"days",data:l})},buildDetailUrl:function(e){if(!e)return;var t="/webapp/hotel/{0}hoteldetail/{1}.html?days={2}&num={3}&atime={4}",r=f.Q.getKey("city"),i=r.type==2?"oversea/":"",s=r.type==2?f.Q.getKey("rooms"):1,o=f.Q.getKey("days"),u=f.Q.getKey("inDay").replace(/-/g,"");return n.stringBuilder(t,i,e,o,s,u)},recoverKWACStatus:function(e){var t=this,n=e.tempInputText,r=e.tempACList,i=_.template(t.tmplCityDestinationList),s=t.elmlayerSearchBox_listBox.find("#js_layerSearchBox_listBox_destination"),o=t.elmlayerSearchBox_listBox.find("#js_layerSearchBox_listBox_empty"),u=t.formatKWACList(r,n);this.elmGroundLayerBody.hide(),F(!1),this.headerview&&this.headerview.root&&this.headerview.root.hide(),this.elmSearchBox.hide(),this.elmlayerSearchBox.show(),this.elmPopInput.val(n),this.elmPopInput.removeAttr("readonly"),this.elmPopInput.focus(),this.elmBtnXClear.show();var a=i(u);s.html(a),t.elmlayer_des_ac_history_listbox.hide(),u.topBar?(t.$el.find(".js_topbar").show(),t.elmlayerSearchBox_listBox.css({top:78})):(t.$el.find(".js_topbar").hide(),t.elmlayerSearchBox_listBox.css({top:44})),t.elmlayerSearchBox_listBox.show(),o.hide()},formatKWACList:function(e,t){var n=[],r=this,i=!1;if(e instanceof Array&&e.length>0)for(var s=0,o=e.length;s<o;s++){var u=e[s],a=u.attribute,f=u.cateid,l=u.region,c=u.type,h={};u["type"]==64&&u.htlinfo&&(u.htlinfo.startprice&&(h.cur=u.htlinfo.startprice.cur==="RMB"||u.htlinfo.startprice.cur==="CNY"?"&yen;":u.htlinfo.startprice.cur,h.price=u.htlinfo.startprice.price,i=!0),u.htlinfo.point!==undefined&&(h.point=u.htlinfo.point),u.htlinfo.zone&&(h.zone=u.htlinfo.zone)),n.push({attribute:a,cateid:f,region:l,type:c,htlinfoCus:_.isEmpty(h)?null:h})}var p={kwList:n,curKw:t,destinationACMapKeyName:g,topBar:i};return p},hideDesACList:function(){w.abort(),this.elmInputLoadingIcon.hide(),this.elmBtnXClear.hide(),this.searchTimeout&&clearTimeout(this.searchTimeout),this.elmlayerSearchBox_listBox.hide(),this.elmlayerSearchBox_listBox.find("ul#js_layerSearchBox_listBox_destination").empty(),this.$el.find(".js_topbar").hide()},showDesACList:function(){var e=this,t=e.elmBtnXClear,n=e.elmInputLoadingIcon,r=e.elmPopInput.val().trim().toLowerCase(),i=_.template(e.tmplCityDestinationList),s=e.elmlayerSearchBox_listBox.find("#js_layerSearchBox_listBox_destination"),o=e.elmlayerSearchBox_listBox.find("#js_layerSearchBox_listBox_empty");o.hide(),r=e.removeScript(r),r?(t.show(),n.show(),w.setParam({word:r}),e.searchTimeout&&clearTimeout(e.searchTimeout),e.searchTimeout=setTimeout(function(){w.excute(function(t){n.hide();var u=t.keywords||[],a=e.formatKWACList(t.keywords,r),f=i(a);s.html(f),e.elmlayer_des_ac_history_listbox.hide(),e.elmlayerSearchBox_listBox.show(),B=u,e.DesACList=u,L.setAttr("lastDestinationACInfo",{tempInputText:r,tempACList:t.keywords}),a.topBar?(e.$el.find(".js_topbar").show(),e.elmlayerSearchBox_listBox.css({top:78})):(e.$el.find(".js_topbar").hide(),e.elmlayerSearchBox_listBox.css({top:44})),u.length?(s.show(),o.hide()):(s.hide(),L.setAttr("lastDestinationACInfo",null),o.show()),e.elmlayerSearchBox_listBox.show(),e.hideLoading(),e.hideWarning404()},function(t){e.elmlayer_des_ac_history_listbox.hide(),e.elmlayerSearchBox_listBox.show(),n.hide(),s.hide(),L.setAttr("lastDestinationACInfo",null),o.show()})},500)):(e.hideDesACList(),L.setAttr("lastDestinationACInfo",null),e._touchend({delayTime:0}))},getHtmlOfDesACHistoryList:function(){var e=this,t,n,r=[],i=k.getAttr("hisList"),s=10,o;if(i instanceof Array&&i.length>0){n=i.length,n>s&&(n=s);for(t=0;t<n;t++)r.push(i[t])}return o=_.template(e.tmplDesACHisList,{keys:r,destinationACMapKeyName:g}),o},addDesAC2History:function(e){var t=k.getAttr("hisList"),n=10,r=e.type.toString()+"."+e.attribute.wordid.toString();t===null&&(t=[]);var i=t.length;i>n&&t.splice(n,i-n);for(var s=0,i=t.length;s<i;s++){var o=t[s],u=o.type.toString()+"."+o.attribute.wordid.toString();if(r===u){t.splice(s,1);break}}i=t.length,i<n?t.unshift(e):i===n&&(t.unshift(e),t.splice(n,1)),k.setAttr("hisList",t)},eventLayerListTouchmove:function(){this.elmPopInput.blur()},eventSearchBoxClicked:function(e){this.elmGroundLayerBody.hide(),F(!1),this.headerview.root&&this.headerview.root.hide(),this.elmSearchBox.hide(),this.elmlayerSearchBox.show(),this.elmPopInput.val(""),this.elmPopInput.removeAttr("readonly"),this.elmPopInput.focus(),this._keyfocus()},removeScript:function(e){return e=e.replace(/<script>.*<\/script>/ig,""),e},_keyInput:function(){this.showDesACList()},_keyfocus:function(){this._touchend({delayTime:m})},_touchend:function(e){var t=this,n=e.delayTime,r=e.callBack,i=function(){var e=t.getHtmlOfDesACHistoryList();t.elmlayer_des_ac_history_listbox.empty(),t.elmlayer_des_ac_history_listbox.append(e),t.elmlayer_des_ac_history_listbox.show()},s=function(){var e=t.elmlayerSearchBox.find("input"),n=e.val().replace(/\s*/,"");n?t.showDesACList():i()};n?window.setTimeout(function(){s(),r&&r.call()},n):(s(),r&&r.call())},eventClearDesAChistory:function(){var e=this;e.$el.find(".js_layer_list_wrap").hide(),k.setAttr("hisList",[]);var t=e.getHtmlOfDesACHistoryList();e.elmlayer_des_ac_history_listbox.empty(),e.elmlayer_des_ac_history_listbox.append(t),e.elmlayer_des_ac_history_listbox.show()},eventCancelSearchBox:function(e){var t=this;try{this.hideDesACList();var n=L.getAttr("lastDestinationACInfo")||{},r=t.elmPopInput.val(),i="F";r==n.tempInputText&&n.tempACList&&n.tempACList.length&&(i="T"),V({destination_type:"input",destination_input:r,status:"cancel",ismatch:i,destination:"",property:"",isoversea:""}),t.lastViewName=="detail"&&(this.renderSwitchTab(this.elmTab),this.showHeaderView(this),this.renderList(null,function(){t.turning()})),this.elmlayerSearchBox.hide(),this.hideWarning404(),this.$el.find(".js_topbar").hide(),this.elmlayerSearchBox_listBox.hide(),this.elmlayer_des_ac_history_listbox.hide(),this.header.show(),$("#headerview").show(),this.elmSearchBox.show(),this.elmGroundLayerBody.show(),b.abort(),F(!0)}catch(s){}},eventSearchBoxClear:function(e){b.abort(),this.elmBtnXClear.hide(),this.elmInputLoadingIcon.hide(),this.elmPopInput.val(""),this.$el.find(".js_topbar").hide(),this.elmlayerSearchBox_listBox.hide(),this._keyfocus()},eventToggleList:function(e){var t=e.currentTarget?$(e.currentTarget):e,n=t.parent(),r=t.next(),i=this.getSelectedCityTab();if(n.hasClass("js_char_city")){var s=this.elmCharCityList.not(n).filter(".cui-arrow-open");s.removeClass("cui-arrow-open").addClass("cui-arrow-close"),s.find(".hotel-city-tags, .cui-city-n").hide()}if(r.length<1){var o=t.text().trim(),u=i.type+"."+o,a={list:x.getAttr(u),i:o,selectedName:this.getDefaultCityName(),selectedCity:f.Q.getQueryParams().city},l=this.tmplCityCategoryCityList,c="";c=_.template(l,a),t.after(c)}r.toggle(),n.toggleClass("cui-arrow-close cui-arrow-open"),n.hasClass("js_char_city")&&(document.body.scrollTop=(n.offset()&&n.offset().top||0)-132)},eventSelectedCity:function(e){function E(){var e=u.getSelectedCityTab();e.type===O[1].type?u.setType(1):u.setType(2),R(),u.back()}function S(e){var t=e?O[e.type||1].type:null,n=null;e&&c.isValidJetLag(e[y])&&(n=e[y]),u.setHistoryCities(t,e);var r=C.get();p&&r&&f.Q.getKey("positionCity")&&(e=f.Q.getKey("positionCity")),q(e)||l.clearRelKwText(),u._setStoreQueryHotelList(e);if(!e)E();else{var i=(e&&e.ctryId)<2?!0:!1;i==u.isOutlandHotel()&&R(),u.lastViewName=="searchlist"?u.forwardJump("searchlist",{oversea:e.type==1?"":"oversea/",cityname:e.cPY,cityid:e.cityId}):u.back()}}var n=e.target.getAttribute("data-path")||"",r=$(e.currentTarget),i=r.attr("data-mark"),s=n.split(".")[0],o=n.split(".")[1],u=this,a="",h=null,p=!1,d=this.getCacheCityList(A.type.toString()),v=f.Q.getKey("positionCity");!H||H.removeAttribute("class"),e.target.className="current",H=e.target;switch(i){case"pos_around":p=!0,h=null,z(!1),S(h);break;case"pos_city":if(v&&v.cityId){var m=v&&v.cityId,g=v&&v.type,b=g==2?t.getOverseaCityByID:t.getCityByID;b.call(t,{id:m,callback:function(e){h=e,z(!0),S(h)},error:function(){null}})}else h=null,z(!1),S(h);break;case"city":n.indexOf("hotCities")>-1||n.indexOf("historyCities")>-1?h=d[s][o]:h=d.categoryCities[s][o],z(!0),S(h)}try{h&&V({destination:h.cname,destination_input:"",property:"",destination_type:"citypageclick",ismatch:"",status:"search",isoversea:h.type==2?"T":"F"})}catch(w){}},eventSelectedSearchCity:function(e){var t=this,n=$(e.currentTarget),r=n.index(),i=n.attr("data-source"),s=i==="history"?k.getAttr("hisList"):L.getAttr("lastDestinationACInfo").tempACList,o=s[r]||{},u=o.region||{},a=o.attribute||{},c=(o.cateid&1)===1,h=c?"inland":"oversea",p=u.isdisctrict,d=o.type,v={cityId:u.cid,cname:p?u.distname+"("+u.cname+")":u.cname,cEN:u.cengname,cPY:c?u.cengname:"",cJP:"",cfrl:"",ctryId:u.countryid,ctryCN:u.countryname,ctryEN:u.countryengname,state:u.state,stateEN:u.stateen,did:u.distid==0?-1:u.distid,type:o.cateid,tzone:u.tzone},m=a.keyword+(!c&&a.engkeyword?"|"+a.engkeyword:""),y=g[d.toString()].map2KeyName,b=null;switch(y){case"airport":b={id:a.wordid,text:m,geos:a.cordinfo};break;case"zone":b={id:a.wordid,text:m};break;case"district":b={id:a.wordid,text:m};break;case"city":b=v;break;case"landMark":b={id:a.wordid,text:m,geos:a.cordinfo};break;case"hotel":b={id:a.wordid,text:m,geos:a.cordinfo}}var w={keyName:y,data:b};(!q(v)||y!=="city")&&l.clearRelKwText(),f.Q.setKey({keyName:"city",data:v}),f.Q.setKey({keyName:"isSearchListWithCity",data:!0}),f.Q.setKey({keyName:"needGetGeo",data:!1}),y!=="city"&&f.Q.setKey(w),this.setHistoryCities(h,v);var E=s[r];this.addDesAC2History(E);var S=l.constructKwText(f.Q.getQueryParams());f.Q.setKwText(S);var x={destination:v.cname,destination_type:i==="history"?"historyclick":"searchpageclick",destination_input:i==="history"?"":this.elmPopInput.val(),property:n.find(".js_search_typename").text(),status:"search",ismatch:i==="history"?"":"T",isoversea:v.type==2?"T":"F"};V(x);if(c==this.isOutlandHotel()){R();var T=c?"":"oversea/",N="/webapp/hotel/"+T+"citylist"+location.search+location.hash;if(history.replaceState){history.replaceState(history.state,document.title,N);var C=this.getHistory();C.forward("citylist",location.href,C.getLastView().ver,!0),C.confirmForward("citylist")}else window.location.replace(N)}var A=o.htlinfo&&o.htlinfo.id||o.attribute&&o.attribute.wordid;if(o.type&&o.type==64&&i=="ac"&&A){this.validateStoreDate();var O=this.buildDetailUrl(A);this.forwardJump("detail",O)}else this.back()},loadingPosition:function(e){var n=this.getDefaultCityName(),r=this,i=function(){e.hide()};e.css("display")==="none"&&e.css("display",""),v.ClearPosition(),v.Subscribe("hotel/citylist",{onStart:function(){e.hide(),e.attr("data-cityname",""),f.Q.clearKey("address"),f.Q.clearKey("requestLocale"),f.Q.setKey({keyName:"needGetGeo",data:!0})},onPosComplete:function(e,t){},onComplete:function(e){C.set(e),f.Q.setKey({keyName:"address",data:e}),f.Q.setKey({keyName:"requestLocale",data:e}),f.Q.setKey({keyName:"needGetGeo",data:!1})},onCityComplete:function(n){if(n.CityEntities&&n.CityEntities[0]){var r=t.realCity(n.CityEntities),s=r.CityID,o=r.CityName,u=n.CountryName;o.indexOf("市")>0&&(o=o.replace("市","").trim());var u=n&&n.CountryName||"",a=u==="中国"?!1:!0,l=a?t.getOverseaCityByID:t.getCityByID;l.call(t,{id:s,callback:function(t){var n=1;u!="中国"&&(n=2),t||(t={cityId:s,cname:o,countrytype:n}),f.Q.setKey({keyName:"positionCity",data:t}),e.attr("data-cityname",o),e.text(o).show();var r=f.Q.getKey("city");r&&r.cname===t.cname&&(f.Q.setKey({keyName:"city",data:t}),e.addClass("current"))},error:i})}},onError:i,onPosError:i},this)},showHeaderView:function(e){this.header.set({title:"选择城市",home:!1,back:!0,events:{returnHandler:function(t){f.Q.setKey({keyName:"needGetGeo",data:!1}),e._goBack.call(e,t)}}}),this.header.show()},renderSwitchTab:function(e){var t=this.uiTab,n=this,r=this.isOutlandHotel();r?A={id:2,name:"海外城市",type:"oversea"}:A={id:1,name:"国内城市",type:"inland"},t||(t=this.uiTab=new o({wrapper:e,datamodel:{data:[{id:1,name:"国内城市",type:"inland"},{id:2,name:"海外城市",type:"oversea"}],selectedKey:A.id||1},onChange:function(e){A=e,n.setSelectedCityTab(e.id),n.renderList(e.type)}})),t.wrapper=this.elmTab,t.show(),t.setVal(A.id)},renderList:function(e,n){function u(e){var t=i.tmplCityMainList,s=null;e.selectedName=i.getDefaultCityName(),e.selectedCity=f.Q.getQueryParams().city,i.lastViewId==="searchlist"?e.hideMyPos=!0:e.hideMyPos=!1,r==="inland"&&(i.elmTmplOverseaCityMainListMark.hide(),i.elmTmplInlandCityMainListMark.show(),s=_.template(t,e),i.elmTmplInlandCityMainListMark.html("").append(s),i.elmCurrentCity=i.elmTmplInlandCityMainListMark.find('li[data-id="js_postion"]')),r==="oversea"&&(i.elmTmplInlandCityMainListMark.hide(),i.elmTmplOverseaCityMainListMark.show(),s=_.template(t,e),i.elmTmplOverseaCityMainListMark.html("").append(s),i.elmCurrentCity=i.elmTmplOverseaCityMainListMark.find('li[data-id="js_postion"]')),D[r]=e,_.isFunction(n)&&n(),i.setPosition();var o=_.compact(_.map(e.categoryCities,function(e,t){return e&&e.length?t:null})),u=e.historyCities&&e.historyCities.length;i.renderSideNav(o,u,r)}function a(e){i.uiLoading.hide(),_.isEmpty(e.msg)?i.showWarning404(function(){location.reload()}):i.toast.show(e.msg,2,function(){i.back()})}var r=e,i=this,s=null,o=null;!r&&!!i.uiTab&&_.each(i.uiTab.datamodel.data,function(e,t){i.uiTab.datamodel.selectedKey==e.id&&(r=e.type)}),o=x.get(),!!o&&!_.isEmpty(o[r])?(s={historyCities:T.getAttr(r+".historyCities"),hotCities:T.getAttr(r+".hotCities"),categoryCities:o[r],cityList:S.getAttr(r),wordList:N.getAttr(r)},u(s),this.elmCharCityList=this.$el.find(".js_char_city")):r==="inland"?(this.uiLoading.show(),t.getInLandCityList({success:function(e){u(e),i.uiLoading.hide(),i.elmCharCityList=i.$el.find(".js_char_city")},error:function(e){a(e)}})):(this.uiLoading.show(),t.getOverseaCityList({success:function(e){u(e),i.uiLoading.hide(),i.elmCharCityList=i.$el.find(".js_char_city")},error:function(e){a(e)}}))},renderSideNav:function(e,t,n){var r=this,i=[{key:"cur",text:"当前",noPop:!0}];t&&i.push({key:"his",text:"历史",noPop:!0}),i.push({key:"hot",text:"热门",noPop:!0});for(var s=0,o=e.length;s<o;s++)i.push({key:e[s].toLowerCase(),text:e[s]});this.sideNav||(this.sideNav=new p),this.sideNav.removeEvent("onClick"),this.sideNav.addEvent("onClick",function(e){r.scrollToCat(e,n)}),this.sideNav.show(i)},scrollToCat:function(e,t){var n=null,r=null,i=t==="oversea"?this.elmTmplOverseaCityMainListMark:this.elmTmplInlandCityMainListMark;switch(e){case"cur":n=i.find(".js_current_city").offset();break;case"his":n=i.find(".js_history_city").offset();break;case"hot":n=i.find(".js_hot_city").offset();break;default:r=i.find('.js_char_city[data-key="'+e+'"]'),r.hasClass("cui-arrow-close")&&this.eventToggleList(r.find(".js_cat_btn"))}r&&(n=r.offset()),n&&n.top&&(document.body.scrollTop=n.top-132)},events:{"click #js_searchBox input":"eventSearchBoxClicked","input #js_layerSearchBox .js_pop_input":"_keyInput","touchmove .js_layer_list":"eventLayerListTouchmove","click .js_btn_clear_des_ac_his":"eventClearDesAChistory","click #js_layerSearchBox .js_btn_cancle":"eventCancelSearchBox","click #js_layerSearchBox .js_clear_input":"eventSearchBoxClear","click #js_tmp_city_mainList_inland_mark .js_cat_btn":"eventToggleList","click #js_tmp_city_mainList_oversea_mark .js_cat_btn":"eventToggleList","click #js_tmp_city_mainList_inland_mark ul > li":"eventSelectedCity","click #js_tmp_city_mainList_oversea_mark ul > li":"eventSelectedCity","click .js_destination_item":"eventSelectedSearchCity","click #js_layerSearchBox .js_search_back":"_goBack"},render:function(){var e=this;this.uiGeoService=h,this.uiLoading=new s,this.elmCurrentCity=null,this.elmTab=this.$el.find("#js_tab"),this.elmCityBox=this.$el.find(".cui-city-box"),this.elmSearchBox=this.$el.find("#js_searchBox"),this.elmGroundLayerBody=this.$el.find(".js_ground_layer_body"),this.elmlayerSearchBox=this.$el.find("#js_layerSearchBox"),this.elmlayerSearchBox_listBox=this.$el.find("#js_layerSearchBox_listBox"),this.elmlayer_des_ac_history_listbox=this.$el.find("#js_layer_des_ac_history_listbox"),this.elmPopInput=this.$el.find(".js_pop_input"),this.elmBtnXClear=this.$el.find(".js_clear_input"),this.elmInputLoadingIcon=this.$el.find(".js_input_loading_icon"),this.elmTmplInlandCityMainListMark=this.$el.find("#js_tmp_city_mainList_inland_mark"),this.elmTmplOverseaCityMainListMark=this.$el.find("#js_tmp_city_mainList_oversea_mark"),this.tmplCityMainList=Lizard.T("js_tmp_city_mainList"),this.tmplCityCategoryCityList=Lizard.T("js_tmp_city_categoryCityList"),this.tmplCitysearchListLoading=Lizard.T("js_tmp_city_loading"),this.tmplCityDestinationList=Lizard.T("js_tmp_city_destinationList"),this.tmplDesACHisList=Lizard.T("js_tmp_des_ac_history_list")},onLoad:function(e){this.render();var t=this,n=f.Q.getKey("requestLocale"),r=L.getAttr("lastDestinationACInfo"),i=this.lastViewName=this.getLastViewName();i=="detail"&&r?this.recoverKWACStatus(r):(this.renderSwitchTab(this.elmTab),t.showHeaderView(t),this.renderList(null,function(){t.turning()}));if(this.isInStrategyApp()||Lizard.isInCtripApp)this.$("#js_tab").css("top","2.2rem"),this.$("#js_searchBox").css("top","0")},onShow:function(){this.setPageId()},onHide:function(){!this.uiTab||this.uiTab.hide(),this.sideNav&&this.sideNav.hide(),this.hideDesACList(),this.elmlayerSearchBox.hide(),this.hideWarning404(),this.$el.find(".js_topbar").hide(),this.elmlayerSearchBox_listBox.hide(),this.elmlayer_des_ac_history_listbox.hide(),this.elmSearchBox.show(),this.elmGroundLayerBody.show(),b.abort(),F(!0),v.UnSubscribe("hotel/citylist")}});return X});